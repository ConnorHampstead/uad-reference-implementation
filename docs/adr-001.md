# ADR-001: Adoption of Unified Asset Delivery (UAD) for Node.js Services

* **Status:** Accepted
* **Date:** 2023-10-27
* **Deciders:** Platform Engineering Team, Security Team, App Team
* **Technical Story:** UAD-REF-001

## Context and Problem Statement
Our organization requires a standardized method for deploying Node.js applications. Previous approaches involved ad-hoc CI/CD pipelines copied between repositories, leading to:
1.  **Configuration Drift:** Security checks (SAST) were inconsistent or missing.
2.  **Mutable Builds:** We could not guarantee that the code tested was the exact code running in production.
3.  **Audit Gaps:** There was no central way to enforce policy updates (e.g., blocking `eval()`) across all services.

## Decision Drivers
* Need for "Secure by Default" delivery.
* Need to decouple *Application Logic* (Asset) from *Delivery Logic* (Supply Chain).
* Need to support "Hermetic Builds" (reproducible environments).

## The Decision
We will adopt the **Unified Asset Delivery (UAD)** model.

1.  **Golden Paths:** We will use reusable GitHub Action Workflows stored in a centralized `_supply_chain` repository. Application teams will strictly consume these workflows via `workflow_call`.
2.  **Immutable Artifacts:** Builds will occur in strict, version-pinned Docker containers. The output will be a single Docker artifact that is promoted through environments.
3.  **Policy as Code:** Governance (Semgrep rules, Terraform modules) will be versioned artifacts. The pipeline will block any Asset that violates the active policy version.
4.  **Ephemeral Infrastructure:** Deployment will be managed via Terraform Modules that abstract the underlying runtime (Docker/Kubernetes).

## Consequences

### Positive
* **Instant Compliance:** All apps using the `v1` track automatically get the latest security scans without code changes.
* **Reduced Cog Load:** Developers only configure `main.tf` and `ci.yaml`; they do not manage Dockerfiles or Jenkins scripts.
* **Traceability:** Every running container can be traced back to a specific Git Commit and Pipeline ID.

### Negative
* **Rigidity:** Developers cannot customize the build steps (e.g., install custom OS packages) without Platform Team involvement.
* **Complexity:** The Supply Chain itself is a complex software product that requires maintenance.

## Compliance
All new Node.js services must use the `build-node-container-v1.yaml` track. Exemptions require a written waiver from the Security Architect.